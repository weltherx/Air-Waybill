<!DOCTYPE html>
<html>
<head>
    <title>QR Code Scanner</title>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1/dist/jsQR.js"></script>
</head>
<body>
    <h1>Scan a QR Code</h1>
    <video id="camera" width="300" height="200" style="display:none;"></video>
    <canvas id="canvas" width="300" height="200"></canvas>
    <div id="result">Rezultatul va apărea aici după scanare.</div>
    <button onclick="startScan()">Start Scan</button>

    <!-- Adding the image from the assets folder -->
    <div>
        <img src="assets/url_test.png" alt="URL Text" width="300" >
    </div>

    <script>
      function startScan() {
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
          .then(function(stream) {
            const video = document.getElementById('camera');
            video.srcObject = stream;
            video.setAttribute("playsinline", true); // required to tell iOS safari we don't want fullscreen
            video.play();
            requestAnimationFrame(tick);
          });

        const canvasElement = document.getElementById("canvas");
        const canvas = canvasElement.getContext("2d");
          
        function tick() {
          const video = document.getElementById('camera');
          if (video.readyState === video.HAVE_ENOUGH_DATA) {
            canvasElement.hidden = false;
            canvasElement.height = video.videoHeight;
            canvasElement.width = video.videoWidth;
            canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
            var imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
            var code = jsQR(imageData.data, imageData.width, imageData.height, {
              inversionAttempts: "dontInvert",
            });
            if (code) {
              document.getElementById("result").textContent = "QR Code Data: " + code.data;
              video.srcObject.getTracks().forEach(track => track.stop());
              video.srcObject = null;
            } else {
              requestAnimationFrame(tick);
            }
          } else {
            requestAnimationFrame(tick);
          }
        }
      }
    </script>
</body>
</html>
